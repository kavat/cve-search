from abc import abstractmethod

from lib.DownloadHandler import DownloadHandler
from lib.db_action import DatabaseAction


class XMLFileHandler(DownloadHandler):
    def __init__(self, feed_type):
        super().__init__(feed_type)
        self.is_update = True

        self.count_update = 0
        self.count_insert = 0

    def __repr__(self):
        """return string representation of object"""
        return "<< XMLFileHandler:{} >>".format(self.feed_type)

    def process_item(self, item):

        if self.is_update:
            self.count_update = self.count_update + 1
            self.queue_update.put(
                DatabaseAction(
                    action=DatabaseAction.actions.UpdateOne,
                    collection=self.feed_type.lower(),
                    doc=item,
                )
            )
        else:
            self.count_insert = self.count_insert + 1
            self.queue_insert.put(
                DatabaseAction(
                    action=DatabaseAction.actions.InsertOne,
                    collection=self.feed_type.lower(),
                    doc=item,
                )
            )

    @abstractmethod
    def file_to_queue(self, *args):
        raise NotImplementedError

    @abstractmethod
    def update(self, **kwargs):
        raise NotImplementedError

    @abstractmethod
    def populate(self, **kwargs):
        raise NotImplementedError
