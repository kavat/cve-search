#!/bin/bash
  
chown redis:redis /var/lib/redis
chown redis:redis /var/log/redis

mongod --fork --logpath /var/log/mongod.log --nojournal
redis-server /etc/redis/redis.conf 

sleep 30

check_mongo_conn=$(echo "show databases" | mongo | grep local)
if [ "${check_mongo_conn}" != "" ]; then
        echo "MONGO DB UP"
        check_mongo_cvedb=$(echo "show databases" | mongo | grep cvedb | grep GB)
        if [ "${check_mongo_cvedb}" != "" ]; then
                echo "CVEDB PRESENT, UPDATING"
                #bash update_db.sh &
        else
                echo "CVEDB NOT PRESENT, CREATING"
                #bash build_db.sh 
        fi
        #bash /fix_redis_keys.sh
	#echo "CREATE UPDATE DB JOB"
	#echo "/opt/cve/cve-search/cron_at_job_update.sh" | at now + 24 hours
        echo "START APPLICATION"
        python3 ./web/index.py > ./log/web.log
else
        echo "MONGO DB DOWN"
fi      

tail -f /dev/null
