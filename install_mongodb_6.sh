#!/bin/bash

curl -fsSL https://www.mongodb.org/static/pgp/server-6.0.asc| gpg --dearmor -o /etc/apt/trusted.gpg.d/mongodb-6.gpg
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | tee /etc/apt/sources.list.d/mongodb-org-6.0.list

arch=$(uname -m)
url_libssl=""
if [ "${arch}" == "aarch64" ]; then
  url_libssl="http://ports.ubuntu.com/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2_arm64.deb"
fi
if [ "${arch}" == "arm64" ]; then
  url_libssl="http://ports.ubuntu.com/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2_arm64.deb"
fi
if [ "${arch}" == "amd64" ]; then
  url_libssl="http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2.16_amd64.deb"
fi

if [ "${url_libssl}" != "" ]; then
  curl -o ./libssl.deb ${url_libssl}
  dpkg -i ./libssl.deb
  apt update
  apt install mongodb-org -y
  ln -s /usr/bin/mongosh /usr/bin/mongo
else
  echo "libssl not found for ${arch}"
  exit 1
fi
